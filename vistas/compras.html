<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/estilos.css">
    <link id="dataTables-style" href="css/jquery.dataTables.css" rel="stylesheet">
    <link rel="stylesheet" href="css/bootstrap.css">
    <title></title>
</head>
<body>
<div class="col-md-12">
<div class="alert alert-success hide" id="agregado">
<button class="close" data-dismiss="alert">&times;</button>
se Agrego la compra correctamente
</div>
</div>
<div class="col-md-12">

<div class="modal-body well">
		<div class="col-md-12 titulo">
		<a class="btn btn-primary pull-left boton-menu" title="abrir con Alt+n" href="listarcompras.html">
			<i class="fa fa-file"></i> Listar Compras
		</a>
		<span>Compras</span><br><br>
		</div>	
				<div  class="row">
				<div class="col-xs-6">
					<div class="form-group">
					<form action="" id="formudatos">
		                <div class="row-xs-6">
							<div class="col-xs-8">
								<label>Proveedor</label>                         
								<select name="proveedor" id="proveedor" class="form-control">
								#foreach($p in $xlista)  
								 <option value="${p.ciproveedor}">${p.nombres}</option>
								#end
		                        </select> 
		                        <input type="hidden" name="tottal2" class="form-control" id="tottal2">
							</div>
							<div class="col-xs-4">
								<label>Fecha </label>
								<div class="input-group col-md-12">
								<input type="text" name="fecha"class="form-control datepicker" style="cursor:pointer;"readonly>
								<i class="form-control-feedback glyphicon glyphicon-calendar"></i>
								</div>
							</div>
						</div>
			                <div class="col-xs-4">
								<div class="form-group">
				                        <br><br>
										<label >N. de Factura</label>
				                        <input type="number" name="factura" class="form-control"  id="factura">
				                        <br>
									</div>
							</div>   
							<div class="col-xs-4">
								<div class="form-group">
			                        <br><br>
									<label>Nombre Comprador</label>
			                        <input type="text" name="nombre" class="form-control"  id="nombre">
			                        <br>
								</div>
							</div> 
							<div class="col-xs-4">
								<label style="padding-top:17px">Donde  Guardara</label>
								<select name="inventario" id="inventario" class="form-control">
								 <option value="Tienda">Tienda</option>
								 <option value="Casa">Casa</option>
		                        </select> 
							</div>
							<div class="row-xs-6">
							<div class="col-xs-5">
								<label>Seleccione Tipo de Pago</label>
								 <select name="pago" id="pago" class="form-control">
								 <option value="1">Al Contado</option>
								 <option value="0">Al Credito</option>
		                        </select> 
							</div>
							</div>
					</form> 
					</div>
				</div>
				<div class="col-xs-6">
					<div class="form-group">
						<div class="row-xs-6">
							<div class="col-xs-4">
								<label>Codigo</label>
								<div class="input-group">
									<input type="text" name="codpro" class="form-control"  id="codpro" required><br>
									<span class="input-group-btn">
										<button class="btn btn-success" id="boton-prod"> >></button>
									</span>
								</div>
							</div>
							<div class="col-xs-8">
								<label>Producto</label>
								<input type="text" name="producto" class="form-control"  id="producto" required><br>
							</div>
						</div>
						<div class="col-xs-5">
							<label>Cantidad</label>
							<div class="input-group">
								<input type="number" name="cantidad" class="form-control decimales" value="1" min="0.5" step="0.5" id="cantidad" required><br>
								<span class="input-group-addon">Unidad(es)</span>

							</div>
							<p id="mensaje-cantidad" style="color:red;"> </p>
						</div>
						<div class="col-xs-5">
							<label>Precio</label>
							<div class="input-group">
								<input type="number" name="precio" class="form-control decimales"  id="precio" step="0.5"><br>
								<span class="input-group-addon">Bs.</span>
							</div>
						</div>
						<div class="col-xs-2">
							<br>
							<button class="btn btn-primary" id="agregartab" style="margin-top:5px;">Agregar</button>
						</div>
					</div>
				</div>
				</div>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<table class="table" data-intro="Lista de Usuarios registrados" data-position="bottom">
				<thead>
				<tr>
					<th>Producto</th>
					<th>Cantidad</th>
					<th>Precio</th>
					<th>Total</th>
				</tr>
				</thead>
					<tbody id="cuerpo-tabla">
					</tbody>
			</table>
			<hr style="border-style:solid none; border-width: 1px 0;">
			<div style="float:left">
					<a class="btn btn-default btn-lg">Cancelar</a>
			</div>

			<div style="float:left; margin-left: 400px;">
				<button class="btn btn-primary btn-lg" id="guardardetalle">Realizar Compra</button>
			</div>
			<div style="float: right;">
				<span><b>Total</b></span> <input type="text" id="tottal" name="tottal" style="width: 108px;"><br><br>
			</div>
		</div>
	</div>

<div class="modal fade" id="modalMensaje">
	<div class="modal-dialog">
		<div class="modal-content">
		<!-- Cabecera del Modal-->
			<div class="modal-header"  style="text-align:center;">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title">Acci&oacute;n Realizada</h4>	
			</div>
			<!-- contenido del modal-->
			<div class="modal-body">
				<div >
					<center><h3 id="mensajito"></h3></center>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary btn-sm " id="cerrarOk" data-dismiss="modal">Aceptar</button>
			</div>
			</div>
	</div>
</div>

</body>
</html>
<script src="js/jquery.dataTables.js"></script>
<script type="text/javascript">
	$(document).ready( function (){
	       $('.datatable').dataTable();
	    });
</script>
<script type="text/javascript">
	$(".datepicker").datepicker({
		format: 'dd-mm-yyyy', //formato de la fecha
		endDate:'5d', // deshabilita las fechas siguientes
		autoclose: true, //en true se cierra automaticamente despues de selecionar la fecha
		orientation:'bottom',
		todayHighlight:true
	});
</script>
<script type="text/javascript">

$("#boton-prod").click(function(){
		var codpro = $("#codpro").val();
		$.ajax({
		type : "POST",
		url :"obtenerProducto2.html",
		data : {"codpro":codpro},
		success:function(fat){
			if(fat!="[]"){
				var lista = fat.split(",");
					$("#producto").val(lista[1].substring(lista[1].indexOf("=")+1));
					$("#precio").val(lista[2].substring(lista[2].indexOf("=")+1));
					$("#precio").attr("min",lista[2].substring(lista[2].indexOf("=")+1));

			}else{
				$('#mensajito').text("Elemento no existe");
				$('#modalMensaje').modal('show');
				$("#cerrarOk").attr('disabled',true);
					setTimeout(function (){
						$('#modalMensaje').modal('hide');
						$("#cerrarOk").attr('disabled',false);
					},1500);

			}
		}
	});
	});

var i = 0;
var total =0;
var prods =new Array();
var cants =new Array();
var precios =new Array();
prods = [];
cants = [];
precios =[];
$("#agregartab").click(function(){
var codpro = $("#codpro").val();
if(codpro!=""){
	var producto = $("#producto").val();
	var precio =$("#precio").val();
	var cantidad = $("#cantidad").val();
	total=parseFloat(total)+parseFloat(precio*cantidad);
	
	prods[i]=$("#codpro").val();;
	cants[i]=cantidad;
	precios[i]=precio;
	$("#cuerpo-tabla").append("<tr><td>"+producto+"</td>"+
	"<td>"+cantidad+"</td> <td>"+precio+"</td><td>"+trunc((precio*cantidad),2)+"</td></tr>");
	$("#tottal").val(total);
	$("#tottal2").val(total);
	$("#producto").val("");
	$("#precio").val("");
	$("#codpro").val("");

	i++;
	}	
	else{
		$("#mensaje-cantidad").text("Debe llenar todos los Datos");
						setTimeout(function (){
							$("#mensaje-cantidad").text("");
						},3000);
	}
});

$("#guardardetalle").click(function(){
	if(prods.length==0){
		alert("Debe Seleccionar al menos Un Elemento")
	}else{
			var datos = $("#formudatos").serialize();
			$.ajax({
				type : "POST",
				url :"agregarCompra.html",
				data : datos,
				success : function(e){
					$('#mensajito').text("Compra Realizada con exito");
					$('#modalMensaje').modal('show');
				}
				});
			
			
setTimeout(function (){
		for(var j=0;j<prods.length;j++){
				$.ajax({
				type : "POST",
				url :"agregarDetalle1.html",
				data : {"producto":prods[j],"cantidad":cants[j],"precio":precios[j]},
				});
			}
},600);
			
		


			
			
	}
});
$("#cerrarNo").click(function(){
	$('#mensajito').text("Compra Realizada con exito");
	$('#modalMensaje').modal('show');
});

$("#cerrarOk").click(function(){
	setTimeout(function (){
		$("#contenido").load(ultimolink);
	},300);
});

$("#cliente").on('keyup',function(){
	$(this).val($(this).val().toUpperCase());
});

$(".boton-menu").click(function(e){
    e.preventDefault();
    var link =$(this).attr("href");
    $("#contenido").load(link);
    ultimolink = link;
});

</script>
